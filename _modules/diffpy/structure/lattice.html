<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>diffpy.structure.lattice &mdash; diffpy.structure 3.2.0rc0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=7e2bcb0f"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            diffpy.structure
          </a>
              <div class="version">
                3.2.0rc0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/diffpy.structure.html">Package API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">diffpy.structure</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../structure.html">diffpy.structure</a></li>
      <li class="breadcrumb-item active">diffpy.structure.lattice</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for diffpy.structure.lattice</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">##############################################################################</span>
<span class="c1">#</span>
<span class="c1"># diffpy.structure  by DANSE Diffraction group</span>
<span class="c1">#                   Simon J. L. Billinge</span>
<span class="c1">#                   (c) 2008 trustees of the Michigan State University.</span>
<span class="c1">#                   All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># File coded by:    Pavol Juhas</span>
<span class="c1">#</span>
<span class="c1"># See AUTHORS.txt for a list of people who contributed.</span>
<span class="c1"># See LICENSE_DANSE.txt for license information.</span>
<span class="c1">#</span>
<span class="c1">##############################################################################</span>

<span class="sd">&quot;&quot;&quot;Class Lattice stores properties and provides simple operations in lattice</span>
<span class="sd">coordinate system.</span>

<span class="sd">Attributes</span>
<span class="sd">----------</span>
<span class="sd">cartesian : Lattice</span>
<span class="sd">    Constant instance of Lattice, default Cartesian system.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span> <span class="k">as</span> <span class="nn">numalg</span>

<span class="kn">from</span> <span class="nn">diffpy.structure.structureerrors</span> <span class="kn">import</span> <span class="n">LatticeError</span>

<span class="c1"># Helper Functions -----------------------------------------------------------</span>

<span class="c1"># exact values of cosd</span>
<span class="n">_EXACT_COSD</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">:</span> <span class="o">+</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">:</span> <span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">120.0</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">180.0</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">240.0</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">270.0</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">300.0</span><span class="p">:</span> <span class="o">+</span><span class="mf">0.5</span><span class="p">}</span>


<div class="viewcode-block" id="cosd">
<a class="viewcode-back" href="../../../mod_lattice.html#diffpy.structure.lattice.cosd">[docs]</a>
<span class="k">def</span> <span class="nf">cosd</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the cosine of *x* (measured in degrees).</span>

<span class="sd">    Avoid round-off errors for exact cosine values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : float</span>
<span class="sd">        The angle in degrees.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The cosine of the angle *x*.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">_EXACT_COSD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="mf">360.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">rv</span></div>



<div class="viewcode-block" id="sind">
<a class="viewcode-back" href="../../../mod_lattice.html#diffpy.structure.lattice.sind">[docs]</a>
<span class="k">def</span> <span class="nf">sind</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the sine of *x* (measured in degrees).</span>

<span class="sd">    Avoid round-off errors for exact sine values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : float</span>
<span class="sd">        The angle in degrees.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The sine of the angle *x*.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">cosd</span><span class="p">(</span><span class="mf">90.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span></div>



<span class="c1"># ----------------------------------------------------------------------------</span>


<div class="viewcode-block" id="Lattice">
<a class="viewcode-back" href="../../../mod_lattice.html#diffpy.structure.lattice.Lattice">[docs]</a>
<span class="k">class</span> <span class="nc">Lattice</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;General coordinate system and associated operations.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : float or Lattice, Optional</span>
<span class="sd">        The cell length *a*. When present, other cell parameters</span>
<span class="sd">        must be also specified. When of the *Lattice* type, create</span>
<span class="sd">        a duplicate Lattice.</span>
<span class="sd">    b : float</span>
<span class="sd">        The cell length *b*.</span>
<span class="sd">    c : float</span>
<span class="sd">        The cell length *c*.</span>
<span class="sd">    alpha : float</span>
<span class="sd">        The angle between the *b* and *c* axes in degrees.</span>
<span class="sd">    beta : float</span>
<span class="sd">        The angle between the *b* and *c* axes in degrees.</span>
<span class="sd">    gamma : float</span>
<span class="sd">        The angle between the *a* and *b* axes in degrees.</span>
<span class="sd">    baserot : array_like, Optional</span>
<span class="sd">        The 3x3 rotation matrix of the base vectors with respect</span>
<span class="sd">        to their standard setting.</span>
<span class="sd">    base : array_like, Optional</span>
<span class="sd">        The 3x3 array of row base vectors. This must be the</span>
<span class="sd">        only argument when present.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    metrics : numpy.ndarray</span>
<span class="sd">        The metrics tensor.</span>
<span class="sd">    base : numpy.ndarray</span>
<span class="sd">        The 3x3 matrix of row base vectors in Cartesian coordinates,</span>
<span class="sd">        which may be rotated, i.e., ``base = stdbase @ baserot``.</span>
<span class="sd">    stdbase : numpy.ndarray</span>
<span class="sd">        The 3x3 matrix of row base vectors in standard orientation.</span>
<span class="sd">    baserot : numpy.ndarray</span>
<span class="sd">        The rotation matrix for the `base`.</span>
<span class="sd">    recbase : numpy.ndarray</span>
<span class="sd">        The inverse of the `base` matrix, where the columns give</span>
<span class="sd">        reciprocal vectors in Cartesian coordinates.</span>
<span class="sd">    normbase : numpy.ndarray</span>
<span class="sd">        The `base` vectors scaled by magnitudes of reciprocal cell lengths.</span>
<span class="sd">    recnormbase : numpy.ndarray</span>
<span class="sd">        The inverse of the `normbase` matrix.</span>
<span class="sd">    isotropicunit : numpy.ndarray</span>
<span class="sd">        The 3x3 tensor for a unit isotropic displacement parameters in this</span>
<span class="sd">        coordinate system. This is an identity matrix when this Lattice</span>
<span class="sd">        is orthonormal.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    The array attributes are read-only. They get updated by changing</span>
<span class="sd">    some lattice parameters or by calling the `setLatPar()` or</span>
<span class="sd">    `setLatBase()` methods.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Create a Cartesian coordinate system:</span>

<span class="sd">    &gt;&gt;&gt; Lattice()</span>

<span class="sd">    Create coordinate system with the cell lengths `a`, `b`, `c`</span>
<span class="sd">    and cell angles `alpha`, `beta`, `gamma` in degrees:</span>

<span class="sd">    &gt;&gt;&gt; Lattice(a, b, c, alpha, beta, gamma)</span>

<span class="sd">    Create a duplicate of an existing Lattice `lat`:</span>

<span class="sd">    &gt;&gt;&gt; Lattice(lat)</span>

<span class="sd">    Create coordinate system with the base vectors given by rows</span>
<span class="sd">    of the `abc` matrix:</span>

<span class="sd">    &gt;&gt;&gt; Lattice(base=abc)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># round-off tolerance</span>
    <span class="n">_epsilon</span> <span class="o">=</span> <span class="mf">1.0e-8</span>

    <span class="c1"># properties -------------------------------------------------------------</span>

    <span class="n">a</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setLatPar</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">value</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The unit cell length *a*.&quot;</span>
    <span class="p">)</span>

    <span class="n">b</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setLatPar</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="n">value</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The unit cell length *b*.&quot;</span>
    <span class="p">)</span>

    <span class="n">c</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setLatPar</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="n">value</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The unit cell length *c*.&quot;</span>
    <span class="p">)</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setLatPar</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">value</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The cell angle *alpha* in degrees.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">beta</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_beta</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setLatPar</span><span class="p">(</span><span class="n">beta</span><span class="o">=</span><span class="n">value</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The cell angle *beta* in degrees.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">gamma</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gamma</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setLatPar</span><span class="p">(</span><span class="n">gamma</span><span class="o">=</span><span class="n">value</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The cell angle *gamma* in degrees.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># read-only derived properties</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unitvolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The unit cell volume when `a = b = c = 1`.&quot;&quot;&quot;</span>
        <span class="c1"># Recalculate lattice cosines to ensure this is right</span>
        <span class="c1"># even if ca, cb, cg data were not yet updated.</span>
        <span class="n">ca</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
        <span class="n">cg</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">)</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">ca</span> <span class="o">*</span> <span class="n">cb</span> <span class="o">*</span> <span class="n">cg</span> <span class="o">-</span> <span class="n">ca</span> <span class="o">*</span> <span class="n">ca</span> <span class="o">-</span> <span class="n">cb</span> <span class="o">*</span> <span class="n">cb</span> <span class="o">-</span> <span class="n">cg</span> <span class="o">*</span> <span class="n">cg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rv</span>

    <span class="n">volume</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">unitvolume</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The unit cell volume.&quot;</span><span class="p">)</span>

    <span class="n">ar</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ar</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The cell length *a* of the reciprocal lattice.&quot;</span><span class="p">)</span>

    <span class="n">br</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_br</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The cell length *b* of the reciprocal lattice.&quot;</span><span class="p">)</span>

    <span class="n">cr</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cr</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The cell length *c* of the reciprocal lattice.&quot;</span><span class="p">)</span>

    <span class="n">alphar</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alphar</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The reciprocal cell angle *alpha* in degrees.&quot;</span><span class="p">)</span>

    <span class="n">betar</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_betar</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The reciprocal cell angle *beta* in degrees&quot;</span><span class="p">)</span>

    <span class="n">gammar</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gammar</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The reciprocal cell angle *gamma* in degrees&quot;</span><span class="p">)</span>

    <span class="n">ca</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ca</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The cosine of the cell angle *alpha*.&quot;</span><span class="p">)</span>

    <span class="n">cb</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cb</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The cosine of the cell angle *beta*.&quot;</span><span class="p">)</span>

    <span class="n">cg</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cg</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The cosine of the cell angle *gamma*.&quot;</span><span class="p">)</span>

    <span class="n">sa</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sa</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The sine of the cell angle *alpha*.&quot;</span><span class="p">)</span>

    <span class="n">sb</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sb</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The sine of the cell angle *beta*.&quot;</span><span class="p">)</span>

    <span class="n">sg</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sg</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The sine of the cell angle *gamma*.&quot;</span><span class="p">)</span>

    <span class="n">car</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_car</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The cosine of the reciprocal angle *alpha*.&quot;</span><span class="p">)</span>

    <span class="n">cbr</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cbr</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The cosine of the reciprocal angle *beta*.&quot;</span><span class="p">)</span>

    <span class="n">cgr</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cgr</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The cosine of the reciprocal angle *gamma*.&quot;</span><span class="p">)</span>

    <span class="n">sar</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sar</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The sine of the reciprocal angle *alpha*.&quot;</span><span class="p">)</span>

    <span class="n">sbr</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sbr</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The sine of the reciprocal angle *beta*.&quot;</span><span class="p">)</span>

    <span class="n">sgr</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sgr</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The sine of the reciprocal angle *gamma*.&quot;</span><span class="p">)</span>

    <span class="c1"># done with properties ---------------------------------------------------</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">baserot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># build a set of provided argument names for later use.</span>
        <span class="n">apairs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="n">gamma</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;baserot&quot;</span><span class="p">,</span> <span class="n">baserot</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="n">base</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">argset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">apairs</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># initialize data members, they values will be set by setLatPar()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gamma</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ca</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_br</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alphar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_betar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gammar</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_car</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cbr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cgr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sbr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sgr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baserot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recbase</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normbase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recnormbase</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># work out argument variants</span>
        <span class="c1"># Lattice()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">argset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLatPar</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">,</span> <span class="n">baserot</span><span class="p">)</span>
        <span class="c1"># Lattice(base=abc)</span>
        <span class="k">elif</span> <span class="n">base</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">argset</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;base&#39; must be the only argument.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLatBase</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="c1"># Lattice(lat)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">Lattice</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">argset</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Lattice object must be the only argument.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="c1"># otherwise do default Lattice(a, b, c, alpha, beta, gamma)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">abcabg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">argset</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="n">abcabg</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Provide all 6 cell parameters.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLatPar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">baserot</span><span class="o">=</span><span class="n">baserot</span><span class="p">)</span>
        <span class="k">return</span>

<div class="viewcode-block" id="Lattice.setLatPar">
<a class="viewcode-back" href="../../../mod_lattice.html#diffpy.structure.lattice.Lattice.setLatPar">[docs]</a>
    <span class="k">def</span> <span class="nf">setLatPar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">baserot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set one or more lattice parameters.</span>

<span class="sd">        This updates all attributes that depend on the lattice parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        a : float, Optional</span>
<span class="sd">            The new value of the cell length *a*.</span>
<span class="sd">        b : float, Optional</span>
<span class="sd">            The new value of the cell length *b*.</span>
<span class="sd">        c : float, Optional</span>
<span class="sd">            The new value of the cell length *c*.</span>
<span class="sd">        alpha : float, Optional</span>
<span class="sd">            The new value of the cell angle *alpha* in degrees.</span>
<span class="sd">        beta : float, Optional</span>
<span class="sd">            The new value of the cell angle *beta* in degrees.</span>
<span class="sd">        gamma : float, Optional</span>
<span class="sd">            The new value of the cell angle *gamma* in degrees.</span>
<span class="sd">        baserot : array_like, Optional</span>
<span class="sd">            The new 3x3 rotation matrix of the base vectors with respect</span>
<span class="sd">            to their standard setting in Cartesian coordinates.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Parameters that are not specified will keep their initial</span>
<span class="sd">        values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_beta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gamma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gamma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">baserot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">baserot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">baserot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ca</span> <span class="o">=</span> <span class="n">ca</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cb</span> <span class="o">=</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cg</span> <span class="o">=</span> <span class="n">cg</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sa</span> <span class="o">=</span> <span class="n">sa</span> <span class="o">=</span> <span class="n">sind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sb</span> <span class="o">=</span> <span class="n">sb</span> <span class="o">=</span> <span class="n">sind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sg</span> <span class="o">=</span> <span class="n">sg</span> <span class="o">=</span> <span class="n">sind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">)</span>
        <span class="c1"># cache the unit volume value</span>
        <span class="n">Vunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unitvolume</span>
        <span class="c1"># reciprocal lattice</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ar</span> <span class="o">=</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">sa</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">Vunit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_br</span> <span class="o">=</span> <span class="n">br</span> <span class="o">=</span> <span class="n">sb</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">Vunit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cr</span> <span class="o">=</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">sg</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="n">Vunit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_car</span> <span class="o">=</span> <span class="n">car</span> <span class="o">=</span> <span class="p">(</span><span class="n">cb</span> <span class="o">*</span> <span class="n">cg</span> <span class="o">-</span> <span class="n">ca</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sb</span> <span class="o">*</span> <span class="n">sg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cbr</span> <span class="o">=</span> <span class="n">cbr</span> <span class="o">=</span> <span class="p">(</span><span class="n">ca</span> <span class="o">*</span> <span class="n">cg</span> <span class="o">-</span> <span class="n">cb</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sa</span> <span class="o">*</span> <span class="n">sg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cgr</span> <span class="o">=</span> <span class="n">cgr</span> <span class="o">=</span> <span class="p">(</span><span class="n">ca</span> <span class="o">*</span> <span class="n">cb</span> <span class="o">-</span> <span class="n">cg</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sa</span> <span class="o">*</span> <span class="n">sb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sar</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">car</span> <span class="o">*</span> <span class="n">car</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sbr</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">cbr</span> <span class="o">*</span> <span class="n">cbr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sgr</span> <span class="o">=</span> <span class="n">sgr</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">cgr</span> <span class="o">*</span> <span class="n">cgr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alphar</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">car</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_betar</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">cbr</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gammar</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">cgr</span><span class="p">))</span>
        <span class="c1"># metrics tensor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">cg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="n">cb</span><span class="p">],</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">cg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="n">ca</span><span class="p">],</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">cb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">ca</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">],</span>
            <span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># standard Cartesian coordinates of lattice vectors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdbase</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">ar</span><span class="p">,</span> <span class="o">-</span><span class="n">cgr</span> <span class="o">/</span> <span class="n">sgr</span> <span class="o">/</span> <span class="n">ar</span><span class="p">,</span> <span class="n">cb</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">sa</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">ca</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">]],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Cartesian coordinates of lattice vectors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stdbase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">baserot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recbase</span> <span class="o">=</span> <span class="n">numalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">)</span>
        <span class="c1"># bases normalized to unit reciprocal vectors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normbase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">*</span> <span class="p">[[</span><span class="n">ar</span><span class="p">],</span> <span class="p">[</span><span class="n">br</span><span class="p">],</span> <span class="p">[</span><span class="n">cr</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recnormbase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recbase</span> <span class="o">/</span> <span class="p">[</span><span class="n">ar</span><span class="p">,</span> <span class="n">br</span><span class="p">,</span> <span class="n">cr</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isotropicunit</span> <span class="o">=</span> <span class="n">_isotropicunit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recnormbase</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="Lattice.setLatBase">
<a class="viewcode-back" href="../../../mod_lattice.html#diffpy.structure.lattice.Lattice.setLatBase">[docs]</a>
    <span class="k">def</span> <span class="nf">setLatBase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set new base vectors for this lattice.</span>

<span class="sd">        This updates the cell lengths and cell angles according to the</span>
<span class="sd">        new base. The `stdbase`, `baserot`, and `metrics` attributes</span>
<span class="sd">        are also updated.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        base : array_like</span>
<span class="sd">            The 3x3 matrix of row base vectors expressed</span>
<span class="sd">            in Cartesian coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="n">detbase</span> <span class="o">=</span> <span class="n">numalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">detbase</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0e-8</span><span class="p">:</span>
            <span class="n">emsg</span> <span class="o">=</span> <span class="s2">&quot;base vectors are degenerate&quot;</span>
            <span class="k">raise</span> <span class="n">LatticeError</span><span class="p">(</span><span class="n">emsg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">detbase</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">emsg</span> <span class="o">=</span> <span class="s2">&quot;base is not right-handed&quot;</span>
            <span class="k">raise</span> <span class="n">LatticeError</span><span class="p">(</span><span class="n">emsg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ca</span> <span class="o">=</span> <span class="n">ca</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cb</span> <span class="o">=</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cg</span> <span class="o">=</span> <span class="n">cg</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sa</span> <span class="o">=</span> <span class="n">sa</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">ca</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sb</span> <span class="o">=</span> <span class="n">sb</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">cb</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sg</span> <span class="o">=</span> <span class="n">sg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">cg</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">ca</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_beta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">cb</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gamma</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">cg</span><span class="p">))</span>
        <span class="c1"># cache the unit volume value</span>
        <span class="n">Vunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unitvolume</span>
        <span class="c1"># reciprocal lattice</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ar</span> <span class="o">=</span> <span class="n">ar</span> <span class="o">=</span> <span class="n">sa</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">Vunit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_br</span> <span class="o">=</span> <span class="n">br</span> <span class="o">=</span> <span class="n">sb</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">Vunit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cr</span> <span class="o">=</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">sg</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="n">Vunit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_car</span> <span class="o">=</span> <span class="n">car</span> <span class="o">=</span> <span class="p">(</span><span class="n">cb</span> <span class="o">*</span> <span class="n">cg</span> <span class="o">-</span> <span class="n">ca</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sb</span> <span class="o">*</span> <span class="n">sg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cbr</span> <span class="o">=</span> <span class="n">cbr</span> <span class="o">=</span> <span class="p">(</span><span class="n">ca</span> <span class="o">*</span> <span class="n">cg</span> <span class="o">-</span> <span class="n">cb</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sa</span> <span class="o">*</span> <span class="n">sg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cgr</span> <span class="o">=</span> <span class="n">cgr</span> <span class="o">=</span> <span class="p">(</span><span class="n">ca</span> <span class="o">*</span> <span class="n">cb</span> <span class="o">-</span> <span class="n">cg</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sa</span> <span class="o">*</span> <span class="n">sb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sar</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">car</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sbr</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">cbr</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sgr</span> <span class="o">=</span> <span class="n">sgr</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">cgr</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alphar</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">car</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_betar</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">cbr</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gammar</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">cgr</span><span class="p">))</span>
        <span class="c1"># standard orientation of lattice vectors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdbase</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">ar</span><span class="p">,</span> <span class="o">-</span><span class="n">cgr</span> <span class="o">/</span> <span class="n">sgr</span> <span class="o">/</span> <span class="n">ar</span><span class="p">,</span> <span class="n">cb</span> <span class="o">*</span> <span class="n">a</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span> <span class="o">*</span> <span class="n">sa</span><span class="p">,</span> <span class="n">b</span> <span class="o">*</span> <span class="n">ca</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">c</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span>
        <span class="p">)</span>
        <span class="c1"># calculate unit cell rotation matrix, base = stdbase @ baserot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baserot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">numalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stdbase</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recbase</span> <span class="o">=</span> <span class="n">numalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">)</span>
        <span class="c1"># bases normalized to unit reciprocal vectors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normbase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">*</span> <span class="p">[[</span><span class="n">ar</span><span class="p">],</span> <span class="p">[</span><span class="n">br</span><span class="p">],</span> <span class="p">[</span><span class="n">cr</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recnormbase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recbase</span> <span class="o">/</span> <span class="p">[</span><span class="n">ar</span><span class="p">,</span> <span class="n">br</span><span class="p">,</span> <span class="n">cr</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isotropicunit</span> <span class="o">=</span> <span class="n">_isotropicunit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recnormbase</span><span class="p">)</span>
        <span class="c1"># update metrics tensor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">a</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">cg</span><span class="p">,</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span> <span class="o">*</span> <span class="n">cb</span><span class="p">],</span> <span class="p">[</span><span class="n">b</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">cg</span><span class="p">,</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span><span class="p">,</span> <span class="n">b</span> <span class="o">*</span> <span class="n">c</span> <span class="o">*</span> <span class="n">ca</span><span class="p">],</span> <span class="p">[</span><span class="n">c</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">cb</span><span class="p">,</span> <span class="n">c</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">ca</span><span class="p">,</span> <span class="n">c</span> <span class="o">*</span> <span class="n">c</span><span class="p">]],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="Lattice.abcABG">
<a class="viewcode-back" href="../../../mod_lattice.html#diffpy.structure.lattice.Lattice.abcABG">[docs]</a>
    <span class="k">def</span> <span class="nf">abcABG</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the cell parameters in the standard setting.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple :</span>
<span class="sd">            A tuple of ``(a, b, c, alpha, beta, gamma)``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rv</span></div>


<div class="viewcode-block" id="Lattice.reciprocal">
<a class="viewcode-back" href="../../../mod_lattice.html#diffpy.structure.lattice.Lattice.reciprocal">[docs]</a>
    <span class="k">def</span> <span class="nf">reciprocal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the reciprocal lattice of the current lattice.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Lattice</span>
<span class="sd">            The reciprocal lattice of the current lattice.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">Lattice</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recbase</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">rv</span></div>


<div class="viewcode-block" id="Lattice.cartesian">
<a class="viewcode-back" href="../../../mod_lattice.html#diffpy.structure.lattice.Lattice.cartesian">[docs]</a>
    <span class="k">def</span> <span class="nf">cartesian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform lattice vector to Cartesian coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        u : array_like</span>
<span class="sd">            Vector of lattice coordinates or an Nx3 array</span>
<span class="sd">            of lattice vectors.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rc : numpy.ndarray</span>
<span class="sd">            Cartesian coordinates of the *u* vector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rc</span></div>


<div class="viewcode-block" id="Lattice.fractional">
<a class="viewcode-back" href="../../../mod_lattice.html#diffpy.structure.lattice.Lattice.fractional">[docs]</a>
    <span class="k">def</span> <span class="nf">fractional</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform Cartesian vector to fractional lattice coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rc : array_like</span>
<span class="sd">            A vector of Cartesian coordinates or an Nx3 array of</span>
<span class="sd">            Cartesian vectors.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        u : numpy.ndarray</span>
<span class="sd">            Fractional coordinates of the Cartesian vector *rc*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recbase</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">u</span></div>


<div class="viewcode-block" id="Lattice.dot">
<a class="viewcode-back" href="../../../mod_lattice.html#diffpy.structure.lattice.Lattice.dot">[docs]</a>
    <span class="k">def</span> <span class="nf">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate dot product of 2 lattice vectors.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        u : array_like</span>
<span class="sd">            The first lattice vector or an Nx3 array.</span>
<span class="sd">        v : array_like</span>
<span class="sd">            The second lattice vector or an array of</span>
<span class="sd">            the same shape as *u*.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float or numpy.ndarray</span>
<span class="sd">            The dot product of lattice vectors *u*, *v*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dp</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dp</span></div>


<div class="viewcode-block" id="Lattice.norm">
<a class="viewcode-back" href="../../../mod_lattice.html#diffpy.structure.lattice.Lattice.norm">[docs]</a>
    <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate norm of a lattice vector.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xyz : array_like</span>
<span class="sd">            A vector or an Nx3 array of fractional coordinates.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float or numpy.ndarray</span>
<span class="sd">            The magnitude of the lattice vector *xyz*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># this is a few percent faster than sqrt(dot(u, u)).</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">cartesian</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="Lattice.rnorm">
<a class="viewcode-back" href="../../../mod_lattice.html#diffpy.structure.lattice.Lattice.rnorm">[docs]</a>
    <span class="k">def</span> <span class="nf">rnorm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hkl</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate norm of a reciprocal vector.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hkl : array_like</span>
<span class="sd">            A vector or an Nx3 array of reciprocal coordinates.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float or numpy.ndarray</span>
<span class="sd">            The magnitude of the reciprocal vector *hkl*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hklcartn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">hkl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recbase</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">hklcartn</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="Lattice.dist">
<a class="viewcode-back" href="../../../mod_lattice.html#diffpy.structure.lattice.Lattice.dist">[docs]</a>
    <span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate distance between 2 points in lattice coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        u : array_like</span>
<span class="sd">            A vector or an Nx3 matrix of fractional coordinates.</span>
<span class="sd">        v : numpy.ndarray</span>
<span class="sd">            A vector or an Nx3 matrix of fractional coordinates.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        *u* and *v* must be of the same shape when matrices.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float or numpy.ndarray</span>
<span class="sd">            The distance between lattice points *u* and *v*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">duv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">-</span> <span class="n">v</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">duv</span><span class="p">)</span></div>


<div class="viewcode-block" id="Lattice.angle">
<a class="viewcode-back" href="../../../mod_lattice.html#diffpy.structure.lattice.Lattice.angle">[docs]</a>
    <span class="k">def</span> <span class="nf">angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate angle between 2 lattice vectors in degrees.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        u : array_like</span>
<span class="sd">            The first lattice vector.</span>
<span class="sd">        v : array_like</span>
<span class="sd">            The second lattice vector.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The angle between lattice vectors *u* and *v* in degrees.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ca</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="c1"># avoid round-off errors that would make abs(ca) greater than 1</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">ca</span><span class="p">):</span>
            <span class="n">ca</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">ca</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ca</span><span class="p">[</span><span class="n">ca</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">ca</span><span class="p">[</span><span class="n">ca</span> <span class="o">&gt;</span> <span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">ca</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">rv</span></div>


<div class="viewcode-block" id="Lattice.isanisotropic">
<a class="viewcode-back" href="../../../mod_lattice.html#diffpy.structure.lattice.Lattice.isanisotropic">[docs]</a>
    <span class="k">def</span> <span class="nf">isanisotropic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">umx</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;True if displacement parameter matrix is anisotropic.</span>

<span class="sd">        This checks if the specified matrix of anisotropic displacement</span>
<span class="sd">        parameters (ADP) differs from isotropic values for this lattice</span>
<span class="sd">        by more than a small round-off error.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        umx : array_like</span>
<span class="sd">            The 3x3 matrix of displacement parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True when *umx* is anisotropic by more than a round-off error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">umx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">umx</span><span class="p">)</span>
        <span class="n">utr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">umx</span><span class="p">)</span> <span class="o">/</span> <span class="n">umx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">udmax</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">umx</span> <span class="o">-</span> <span class="n">utr</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotropicunit</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">udmax</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span>
        <span class="k">return</span> <span class="n">rv</span></div>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;String representation of this lattice.&quot;&quot;&quot;</span>
        <span class="n">I3</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">rotbaseI3diff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baserot</span> <span class="o">-</span> <span class="n">I3</span><span class="p">),</span> <span class="mi">9</span><span class="p">))</span>
        <span class="n">cartlatpar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">])</span>
        <span class="n">latpardiff</span> <span class="o">=</span> <span class="n">cartlatpar</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">abcABG</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rotbaseI3diff</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Lattice(base=</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span>
        <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">latpardiff</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Lattice()&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Lattice(a=</span><span class="si">%g</span><span class="s2">, b=</span><span class="si">%g</span><span class="s2">, c=</span><span class="si">%g</span><span class="s2">, alpha=</span><span class="si">%g</span><span class="s2">, beta=</span><span class="si">%g</span><span class="s2">, gamma=</span><span class="si">%g</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">abcABG</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">s</span></div>



<span class="c1"># End of class Lattice</span>

<span class="c1"># Local Helpers --------------------------------------------------------------</span>


<span class="k">def</span> <span class="nf">_isotropicunit</span><span class="p">(</span><span class="n">recnormbase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate tensor of unit isotropic displacement parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    recnormbase : numpy.ndarray</span>
<span class="sd">        The inverse of normalized base vectors of some lattice.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        The 3x3 matrix of displacement parameters corresponding to</span>
<span class="sd">        a unit isotropic displacements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">isounit</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">recnormbase</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">recnormbase</span><span class="p">)</span>
    <span class="c1"># ensure there are no round-off deviations on the diagonal</span>
    <span class="n">isounit</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">isounit</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">isounit</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">isounit</span>


<span class="c1"># Module Constants -----------------------------------------------------------</span>

<span class="n">cartesian</span> <span class="o">=</span> <span class="n">Lattice</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, The Trustees of Columbia University in the City of New York.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>